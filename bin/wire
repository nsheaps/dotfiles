#!/usr/bin/env bash
# Wiring script to sync _home/ files to ~/ and create necessary symlinks

set -euo pipefail

DOTFILES_DIR="$HOME/src/nsheaps/dotfiles"
HOME_DIR="$HOME"

echo "Wiring dotfiles from $DOTFILES_DIR/_home to $HOME_DIR..."

# Create symlinks for profile.d and interactive.d directories
echo ""
echo "Creating directory symlinks..."
ln -sfn "$DOTFILES_DIR/_home/profile.d" "$HOME_DIR/.profile.d"
echo "  ~/.profile.d → $DOTFILES_DIR/_home/profile.d"

ln -sfn "$DOTFILES_DIR/_home/interactive.d" "$HOME_DIR/.interactive.d"
echo "  ~/.interactive.d → $DOTFILES_DIR/_home/interactive.d"

# Sync RC files from _home/ to ~/
echo ""
echo "Syncing RC files..."

# Function to sync a file
sync_file() {
  local src="$1"
  local dest="$2"

  if [[ -f "$src" ]]; then
    cp "$src" "$dest"
    echo "  Copied $src → $dest"
  fi
}

# Sync zsh files
sync_file "$DOTFILES_DIR/_home/.zshrc" "$HOME_DIR/.zshrc"
sync_file "$DOTFILES_DIR/_home/.zprofile" "$HOME_DIR/.zprofile"
sync_file "$DOTFILES_DIR/_home/.zshenv" "$HOME_DIR/.zshenv"
sync_file "$DOTFILES_DIR/_home/.zsh_plugins.txt" "$HOME_DIR/.zsh_plugins.txt"

# Sync bash files
sync_file "$DOTFILES_DIR/_home/.bashrc" "$HOME_DIR/.bashrc"
sync_file "$DOTFILES_DIR/_home/.bash_profile" "$HOME_DIR/.bash_profile"

echo ""
echo "✓ Wiring complete!"
echo ""
echo "Next steps:"
echo "  1. Review the changes in ~/"
echo "  2. Test with: source ~/.zshrc (or open a new terminal)"
echo "  3. Verify functions work: cc-tmp, cc-newsession, cc-resume"
